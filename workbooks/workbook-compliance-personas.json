{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 1,
      "content": {
        "json": "# ðŸ›¡ï¸ Multi-Persona Compliance Dashboard\n\n**Real-time compliance visibility for Compliance Officers, Security Officers, and Cloud Engineers**\n\nThis dashboard provides role-specific views of your Azure environment's compliance posture, security status, and operational health. Use the parameters below to customize the view for your subscription and resource scope.\n\n---"
      },
      "name": "text - title"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "subscription-filter",
            "version": "KqlParameterItem/1.0",
            "name": "Subscriptions",
            "type": 6,
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "summarize by subscriptionId\r\n| project value = strcat('/subscriptions/', subscriptionId), label = subscriptionId, selected = true",
            "crossComponentResources": [
              "value::selected"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "includeAll": false,
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "defaultValue": "value::all",
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "resourcegroup-filter",
            "version": "KqlParameterItem/1.0",
            "name": "ResourceGroups",
            "type": 2,
            "isRequired": false,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "Resources\r\n| distinct resourceGroup\r\n| order by resourceGroup asc\r\n| project value = resourceGroup, label = resourceGroup",
            "crossComponentResources": [
              "{Subscriptions}"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "includeAll": true,
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "defaultValue": "value::all",
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "environment-tag",
            "version": "KqlParameterItem/1.0",
            "name": "EnvironmentTag",
            "type": 2,
            "isRequired": false,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "Resources\r\n| where isnotempty(tags[\"Environment\"])\r\n| distinct tostring(tags[\"Environment\"])\r\n| order by tags_Environment asc\r\n| project value = tags_Environment, label = tags_Environment",
            "crossComponentResources": [
              "{Subscriptions}"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "includeAll": true,
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "defaultValue": "value::all",
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          }
        ],
        "style": "pills",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources"
      },
      "name": "parameters - filters"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "links": [
          {
            "id": "compliance-officer-tab",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "ðŸ›ï¸ Compliance Officer",
            "subTarget": "ComplianceOfficer",
            "style": "link"
          },
          {
            "id": "security-officer-tab",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "ðŸ”’ Security Officer",
            "subTarget": "SecurityOfficer",
            "style": "link"
          },
          {
            "id": "cloud-engineer-tab",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "âš™ï¸ Cloud Engineer",
            "subTarget": "CloudEngineer",
            "style": "link"
          }
        ]
      },
      "name": "links - persona tabs"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## ðŸ›ï¸ Compliance Officer Dashboard\n\n**Focus: Regulatory adherence, risk management, and audit preparation**\n\nThis section provides executive-level compliance visibility with key metrics, policy compliance status, and audit-ready reporting capabilities."
            },
            "name": "text - compliance officer header"
          },
          {
            "type": 1,
            "content": {
              "json": "**ðŸ“Š Overall Compliance Posture**\n\nThis metric shows your organization's compliance percentage based on Azure Policy evaluations. The percentage represents how many of your resources are compliant with assigned policies divided by total evaluated resources. A higher percentage indicates better adherence to your governance standards.\n\n- **Target**: Maintain >90% compliance\n- **Green**: 85%+ (Good governance)\n- **Yellow**: 70-85% (Needs attention)\n- **Red**: <70% (Immediate action required)"
            },
            "name": "text - compliance posture explanation"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "PolicyResources\r\n| where type == \"microsoft.policyinsights/policystates\"\r\n| extend complianceState = tostring(properties.complianceState)\r\n| summarize \r\n    TotalResources = count(),\r\n    CompliantCount = countif(complianceState == \"Compliant\"),\r\n    NonCompliantCount = countif(complianceState == \"NonCompliant\")\r\n| extend CompliancePercentage = round((CompliantCount * 100.0) / TotalResources, 1)\r\n| project CompliancePercentage, CompliantCount, NonCompliantCount, TotalResources",
              "size": 4,
              "title": "Compliance Overview",
              "timeContext": {
                "durationMs": 86400000
              },
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "CompliancePercentage",
                  "formatter": 1,
                  "formatOptions": {
                    "suffix": "% Overall Compliance"
                  }
                },
                "leftContent": {
                  "columnMatch": "CompliancePercentage",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "redGreen",
                    "aggregation": "Max"
                  },
                  "numberFormat": {
                    "unit": 1,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 1
                    }
                  }
                },
                "showBorder": true
              }
            },
            "name": "query - compliance percentage"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "PolicyResources\r\n| where type == \"microsoft.policyinsights/policystates\"\r\n| extend complianceState = tostring(properties.complianceState)\r\n| summarize \r\n    CompliantCount = countif(complianceState == \"Compliant\")\r\n| project CompliantCount",
              "size": 4,
              "title": "Compliant Resources",
              "timeContext": {
                "durationMs": 86400000
              },
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "CompliantCount",
                  "formatter": 1,
                  "formatOptions": {
                    "suffix": " Compliant Resources"
                  }
                },
                "leftContent": {
                  "columnMatch": "CompliantCount",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "green"
                  }
                },
                "showBorder": true
              }
            },
            "name": "query - compliant resources"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "PolicyResources\r\n| where type == \"microsoft.policyinsights/policystates\"\r\n| extend complianceState = tostring(properties.complianceState)\r\n| summarize \r\n    NonCompliantCount = countif(complianceState == \"NonCompliant\")\r\n| project NonCompliantCount",
              "size": 4,
              "title": "Non-Compliant Resources",
              "timeContext": {
                "durationMs": 86400000
              },
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "NonCompliantCount",
                  "formatter": 1,
                  "formatOptions": {
                    "suffix": " Non-Compliant Resources"
                  }
                },
                "leftContent": {
                  "columnMatch": "NonCompliantCount",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "red"
                  }
                },
                "showBorder": true
              }
            },
            "name": "query - non-compliant resources"
          },
          {
            "type": 1,
            "content": {
              "json": "**ðŸ“ˆ Policy Initiative Compliance Status**\n\nThis chart displays compliance rates for each Policy Initiative (also called Policy Sets) assigned to your environment. Each bar represents a different initiative, with the percentage showing how many resources comply with that specific set of policies.\n\n- **CIS Benchmarks**: Industry security standards\n- **Regulatory Compliance**: Legal/regulatory requirements\n- **Corporate Standards**: Internal governance policies\n\nLower percentages indicate initiatives requiring immediate remediation focus."
            },
            "name": "text - initiative compliance explanation"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "PolicyResources\r\n| where type == \"microsoft.policyinsights/policystates\"\r\n| extend \r\n    complianceState = tostring(properties.complianceState),\r\n    policySetDefinitionId = tostring(properties.policySetDefinitionId)\r\n| where isnotempty(policySetDefinitionId)\r\n| summarize \r\n    CompliantResources = countif(complianceState == \"Compliant\"),\r\n    NonCompliantResources = countif(complianceState == \"NonCompliant\"),\r\n    TotalResources = count()\r\n    by InitiativeName = tostring(split(policySetDefinitionId, \"/\")[-1])\r\n| extend ComplianceRate = round((CompliantResources * 100.0) / TotalResources, 1)\r\n| order by ComplianceRate asc",
              "size": 0,
              "title": "Policy Initiative Compliance Status",
              "timeContext": {
                "durationMs": 86400000
              },
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "visualization": "barchart",
              "chartSettings": {
                "xAxis": "InitiativeName",
                "yAxis": [
                  "ComplianceRate"
                ],
                "seriesLabelSettings": [
                  {
                    "seriesName": "ComplianceRate",
                    "label": "Compliance %"
                  }
                ]
              }
            },
            "name": "query - initiative compliance"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "Resources\r\n| extend hasEnvironmentTag = isnotempty(tags[\"Environment\"])\r\n| extend hasCostCenterTag = isnotempty(tags[\"CostCenter\"])  \r\n| extend hasOwnerTag = isnotempty(tags[\"Owner\"])\r\n| where \"{ResourceGroups}\" == \"value::all\" or resourceGroup in ({ResourceGroups})\r\n| summarize \r\n    TotalResources = count(),\r\n    WithEnvironmentTag = countif(hasEnvironmentTag),\r\n    WithCostCenterTag = countif(hasCostCenterTag),\r\n    WithOwnerTag = countif(hasOwnerTag)\r\n    by resourceGroup\r\n| extend \r\n    EnvironmentTagCompliance = round((WithEnvironmentTag * 100.0) / TotalResources, 1),\r\n    CostCenterTagCompliance = round((WithCostCenterTag * 100.0) / TotalResources, 1),\r\n    OwnerTagCompliance = round((WithOwnerTag * 100.0) / TotalResources, 1)\r\n| order by EnvironmentTagCompliance desc",
              "size": 0,
              "title": "Resource Tagging Compliance by Resource Group",
              "timeContext": {
                "durationMs": 86400000
              },
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "EnvironmentTagCompliance",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "greenRed"
                    },
                    "numberFormat": {
                      "unit": 1,
                      "options": {
                        "style": "decimal",
                        "maximumFractionDigits": 1
                      }
                    }
                  },
                  {
                    "columnMatch": "CostCenterTagCompliance",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "greenRed"
                    },
                    "numberFormat": {
                      "unit": 1,
                      "options": {
                        "style": "decimal",
                        "maximumFractionDigits": 1
                      }
                    }
                  },
                  {
                    "columnMatch": "OwnerTagCompliance",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "greenRed"
                    },
                    "numberFormat": {
                      "unit": 1,
                      "options": {
                        "style": "decimal",
                        "maximumFractionDigits": 1
                      }
                    }
                  }
                ]
              }
            },
            "name": "query - tagging compliance"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "PolicyResources\r\n| where type == \"microsoft.policyinsights/policystates\"\r\n| where tostring(properties.complianceState) == \"NonCompliant\"\r\n| extend \r\n    resourceId = tostring(properties.resourceId),\r\n    policyDefinitionId = tostring(properties.policyDefinitionId),\r\n    policyDefinitionName = tostring(split(properties.policyDefinitionId, \"/\")[-1]),\r\n    resourceType = tostring(properties.resourceType)\r\n| join kind=leftouter (\r\n    Resources\r\n    | project id, name, resourceGroup, location, type, tags\r\n) on $left.resourceId == $right.id\r\n| extend \r\n    ResourceDisplayName = coalesce(name, tostring(split(resourceId, \"/\")[-1])),\r\n    PolicyLink = strcat(\"https://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/\", url_encode(policyDefinitionId))\r\n| project \r\n    ResourceName = ResourceDisplayName, \r\n    ResourceGroup = resourceGroup, \r\n    ResourceType = coalesce(type, resourceType), \r\n    PolicyViolation = policyDefinitionName, \r\n    Location = location,\r\n    ResourceId = resourceId,\r\n    PolicyLink = PolicyLink\r\n| order by ResourceGroup, ResourceName",
              "size": 0,
              "title": "Non-Compliant Resources (Detailed View)",
              "timeContext": {
                "durationMs": 86400000
              },
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "ResourceName",
                    "formatter": 1,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "linkColumn": "ResourceId",
                      "linkIsContextBlade": true
                    }
                  },
                  {
                    "columnMatch": "PolicyViolation",
                    "formatter": 1,
                    "formatOptions": {
                      "linkTarget": "Url",
                      "linkColumn": "PolicyLink",
                      "linkLabel": "View Policy"
                    }
                  },
                  {
                    "columnMatch": "ResourceId",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "PolicyLink",
                    "formatter": 5
                  }
                ],
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "ResourceGroup",
                    "sortOrder": 1
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "ResourceGroup",
                  "sortOrder": 1
                }
              ]
            },
            "name": "query - non compliant resources"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "ComplianceOfficer"
      },
      "name": "group - compliance officer"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## ðŸ”’ Security Officer Dashboard\n\n**Focus: Security controls, threat detection, and risk management**\n\nThis section provides security-focused visibility with threat indicators, vulnerability status, and security configuration analysis."
            },
            "name": "text - security officer header"
          },
          {
            "type": 1,
            "content": {
              "json": "**ðŸ”’ Microsoft Defender for Cloud Recommendations**\n\nThis chart shows security recommendations that require attention, filtered to show only **Unhealthy** (actionable) assessments by severity level. The numbers align with what you see in the Microsoft Defender for Cloud portal under Recommendations.\n\n- **High Severity**: Critical security issues requiring immediate attention\n- **Medium Severity**: Important security improvements to implement\n- **Low Severity**: Security enhancements to consider when possible\n\n*Note: Only shows recommendations requiring action, not all assessments.*"
            },
            "name": "text - defender explanation"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SecurityResources\r\n| where type == \"microsoft.security/assessments\"\r\n| where tostring(properties.status.code) == \"Unhealthy\"\r\n| extend \r\n    severity = tostring(properties.metadata.severity),\r\n    assessmentName = tostring(properties.displayName),\r\n    resourceId = tostring(properties.resourceDetails.id)\r\n| where isnotempty(severity)\r\n| summarize RecommendationCount = count() by severity\r\n| order by case(severity == \"High\", 1, severity == \"Medium\", 2, severity == \"Low\", 3, 4)",
              "size": 0,
              "title": "Microsoft Defender for Cloud Recommendations by Severity",
              "timeContext": {
                "durationMs": 86400000
              },
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "severity",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "RecommendationCount",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "categorical"
                  }
                },
                "rightContent": {
                  "columnMatch": "severity",
                  "formatter": 18,
                  "formatOptions": {
                    "thresholdsOptions": "colors",
                    "thresholdsGrid": [
                      {
                        "operator": "==",
                        "thresholdValue": "High",
                        "representation": "redBright",
                        "text": "High Severity"
                      },
                      {
                        "operator": "==",
                        "thresholdValue": "Medium",
                        "representation": "orange",
                        "text": "Medium Severity"
                      },
                      {
                        "operator": "==",
                        "thresholdValue": "Low",
                        "representation": "yellow",
                        "text": "Low Severity"
                      }
                    ]
                  }
                },
                "showBorder": true
              },
              "chartSettings": {
                "xAxis": "severity",
                "yAxis": [
                  "RecommendationCount"
                ],
                "seriesLabelSettings": [
                  {
                    "seriesName": "High",
                    "color": "red"
                  },
                  {
                    "seriesName": "Medium", 
                    "color": "orange"
                  },
                  {
                    "seriesName": "Low",
                    "color": "yellow"
                  }
                ]
              }
            },
            "name": "query - security recommendations"
          },
          {
            "type": 1,
            "content": {
              "json": "**ðŸ›¡ï¸ Security Posture Overview**\n\nThis metric shows your organization's overall security health based on Microsoft Defender for Cloud assessments:\n\n- **Security Percentage**: Calculated as (Healthy Resources Ã· Total Evaluated Resources) Ã— 100\n- **Healthy Resources**: Resources that pass security assessments (shown in green)\n- **Recommendations**: Number of security issues requiring attention (actionable items)\n\n**Example**: 42.7% means 344 resources are secure out of 805 total assessed resources (344 + 461)\n\n**Target Ranges:**\n- **90%+**: Excellent security posture\n- **75-89%**: Good security, minor improvements needed\n- **60-74%**: Moderate risk, remediation recommended\n- **<60%**: High risk, immediate action required"
            },
            "name": "text - security posture explanation"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SecurityResources\r\n| where type == \"microsoft.security/assessments\"\r\n| extend status = tostring(properties.status.code)\r\n| summarize \r\n    TotalAssessments = count(),\r\n    HealthyResources = countif(status == \"Healthy\"),\r\n    UnhealthyRecommendations = countif(status == \"Unhealthy\"),\r\n    NotApplicable = countif(status == \"NotApplicable\")\r\n| extend ComplianceRate = round((HealthyResources * 100.0) / (HealthyResources + UnhealthyRecommendations), 1)\r\n| project ComplianceRate, UnhealthyRecommendations, HealthyResources, TotalAssessments",
              "size": 4,
              "title": "Security Posture Overview",
              "timeContext": {
                "durationMs": 86400000
              },
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "ComplianceRate",
                  "formatter": 1,
                  "formatOptions": {
                    "suffix": "% Security Posture"
                  }
                },
                "leftContent": {
                  "columnMatch": "ComplianceRate",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "redGreen",
                    "aggregation": "Max"
                  },
                  "numberFormat": {
                    "unit": 1,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 1
                    }
                  }
                },
                "rightContent": {
                  "columnMatch": "HealthyResources",
                  "formatter": 1,
                  "formatOptions": {
                    "suffix": " Healthy Resources"
                  }
                },
                "secondaryContent": {
                  "columnMatch": "UnhealthyRecommendations",
                  "formatter": 1,
                  "formatOptions": {
                    "suffix": " Need Attention"
                  }
                },
                "showBorder": true
              }
            },
            "name": "query - security posture summary"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "Resources\r\n| where type == \"microsoft.network/networksecuritygroups\"\r\n| extend nsgRules = properties.securityRules\r\n| mvexpand nsgRules\r\n| extend \r\n    ruleName = tostring(nsgRules.name),\r\n    access = tostring(nsgRules.properties.access),\r\n    direction = tostring(nsgRules.properties.direction),\r\n    sourceAddressPrefix = tostring(nsgRules.properties.sourceAddressPrefix),\r\n    destinationPortRange = tostring(nsgRules.properties.destinationPortRange)\r\n| where access == \"Allow\" and direction == \"Inbound\" \r\n| where sourceAddressPrefix == \"*\" or sourceAddressPrefix == \"Internet\"\r\n| where \"{ResourceGroups:escape}\" == \"value::all\" or resourceGroup in ({ResourceGroups})\r\n| project NSGName = name, ResourceGroup = resourceGroup, RuleName = ruleName, DestinationPort = destinationPortRange, SourcePrefix = sourceAddressPrefix\r\n| order by NSGName",
              "size": 0,
              "title": "High-Risk Network Security Group Rules (Internet-Facing)",
              "timeContext": {
                "durationMs": 86400000
              },
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "NSGName",
                    "formatter": 1,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "linkIsContextBlade": true
                    }
                  },
                  {
                    "columnMatch": "SourcePrefix",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "*",
                          "representation": "redBright",
                          "text": "Any Source"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Internet",
                          "representation": "orange",
                          "text": "Internet"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "blue",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  }
                ],
                "filter": true
              }
            },
            "name": "query - risky nsg rules"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "Resources\r\n| where type == \"microsoft.network/publicipaddresses\"\r\n| extend \r\n    ipAddress = tostring(properties.ipAddress),\r\n    allocationMethod = tostring(properties.publicIPAllocationMethod),\r\n    associatedResource = tostring(properties.ipConfiguration.id)\r\n| where \"{ResourceGroups:escape}\" == \"value::all\" or resourceGroup in ({ResourceGroups})\r\n| project PublicIPName = name, ResourceGroup = resourceGroup, IPAddress = ipAddress, AllocationMethod = allocationMethod, AssociatedResource = associatedResource, Location = location\r\n| order by ResourceGroup",
              "size": 0,
              "title": "Public IP Address Inventory",
              "timeContext": {
                "durationMs": 86400000
              },
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "PublicIPName",
                    "formatter": 1,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "linkIsContextBlade": true
                    }
                  },
                  {
                    "columnMatch": "IPAddress",
                    "formatter": 1,
                    "formatOptions": {
                      "linkTarget": "Url",
                      "linkLabel": "ðŸ” IP Lookup"
                    }
                  }
                ],
                "filter": true
              }
            },
            "name": "query - public ips"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "Resources\r\n| where type == \"microsoft.storage/storageaccounts\"\r\n| extend \r\n    httpsTrafficOnly = tostring(properties.supportsHttpsTrafficOnly),\r\n    minimumTlsVersion = tostring(properties.minimumTlsVersion),\r\n    allowBlobPublicAccess = tostring(properties.allowBlobPublicAccess),\r\n    encryption = tostring(properties.encryption.services.blob.enabled)\r\n| where \"{ResourceGroups:escape}\" == \"value::all\" or resourceGroup in ({ResourceGroups})\r\n| project \r\n    StorageAccount = name, \r\n    ResourceGroup = resourceGroup, \r\n    HTTPSOnly = httpsTrafficOnly, \r\n    MinTLSVersion = minimumTlsVersion, \r\n    PublicBlobAccess = allowBlobPublicAccess, \r\n    BlobEncryption = encryption,\r\n    Location = location\r\n| order by StorageAccount",
              "size": 0,
              "title": "Storage Account Security Configuration",
              "timeContext": {
                "durationMs": 86400000
              },
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "StorageAccount",
                    "formatter": 1,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "linkIsContextBlade": true
                    }
                  },
                  {
                    "columnMatch": "HTTPSOnly",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "true",
                          "representation": "green",
                          "text": "âœ“ Enabled"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "false",
                          "representation": "red",
                          "text": "âœ— Disabled"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "PublicBlobAccess",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "false",
                          "representation": "green",
                          "text": "âœ“ Disabled"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "true",
                          "representation": "red",
                          "text": "âš  Enabled"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "BlobEncryption",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "true",
                          "representation": "green",
                          "text": "âœ“ Enabled"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "false",
                          "representation": "red",
                          "text": "âœ— Disabled"
                        }
                      ]
                    }
                  }
                ],
                "filter": true
              }
            },
            "name": "query - storage security"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "SecurityOfficer"
      },
      "name": "group - security officer"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## âš™ï¸ Cloud Engineer Dashboard\n\n**Focus: Implementation, automation, and technical optimization**\n\nThis section provides operational insights with resource health, configuration analysis, and optimization opportunities."
            },
            "name": "text - cloud engineer header"
          },
          {
            "type": 1,
            "content": {
              "json": "**ðŸ“Š Resource Distribution by Resource Group**\n\nThis chart shows the number of Azure resources deployed in each Resource Group across your subscriptions. It helps identify:\n\n- **Resource concentration**: Which groups have the most resources\n- **Organizational patterns**: How resources are grouped by teams/projects\n- **Management complexity**: Groups with high resource counts may need subdivision\n- **Cost allocation**: Resource density correlates with potential costs\n\nUse this data for capacity planning, cost management, and organizational governance."
            },
            "name": "text - resource distribution explanation"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "Resources\r\n| summarize \r\n    ResourceCount = count(),\r\n    UniqueTypes = dcount(type),\r\n    UniqueLocations = dcount(location)\r\n    by resourceGroup, subscriptionId\r\n| extend SubscriptionName = tostring(split(subscriptionId, \"/\")[-1])\r\n| where \"{ResourceGroups:escape}\" == \"value::all\" or resourceGroup in ({ResourceGroups})\r\n| order by ResourceCount desc",
              "size": 0,
              "title": "Resource Distribution by Resource Group",
              "timeContext": {
                "durationMs": 86400000
              },
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "visualization": "barchart",
              "chartSettings": {
                "xAxis": "resourceGroup",
                "yAxis": [
                  "ResourceCount"
                ],
                "seriesLabelSettings": [
                  {
                    "seriesName": "ResourceCount",
                    "label": "Resource Count"
                  }
                ]
              }
            },
            "name": "query - resource distribution"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "Resources\r\n| where type == \"microsoft.compute/virtualmachines\"\r\n| extend \r\n    vmSize = tostring(properties.hardwareProfile.vmSize),\r\n    osType = tostring(properties.storageProfile.osDisk.osType),\r\n    managedDisk = isnotempty(properties.storageProfile.osDisk.managedDisk),\r\n    diagnosticsEnabled = isnotempty(properties.diagnosticsProfile)\r\n| where \"{ResourceGroups:escape}\" == \"value::all\" or resourceGroup in ({ResourceGroups})\r\n| project VMName = name, ResourceGroup = resourceGroup, VMSize = vmSize, OSType = osType, ManagedDisk = managedDisk, DiagnosticsEnabled = diagnosticsEnabled, Location = location\r\n| order by ResourceGroup, VMName",
              "size": 0,
              "title": "Virtual Machine Configuration Analysis",
              "timeContext": {
                "durationMs": 86400000
              },
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "VMName",
                    "formatter": 1,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "linkIsContextBlade": true
                    }
                  },
                  {
                    "columnMatch": "ManagedDisk",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "true",
                          "representation": "green",
                          "text": "âœ“ Yes"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "false",
                          "representation": "orange",
                          "text": "âš  No"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "DiagnosticsEnabled",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "true",
                          "representation": "green",
                          "text": "âœ“ Enabled"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "false",
                          "representation": "red",
                          "text": "âœ— Disabled"
                        }
                      ]
                    }
                  }
                ],
                "filter": true
              }
            },
            "name": "query - vm configuration"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "Resources\r\n| where type == \"microsoft.storage/storageaccounts\"\r\n| extend \r\n    sku = tostring(properties.sku.name),\r\n    kind = tostring(properties.kind),\r\n    accessTier = tostring(properties.accessTier)\r\n| extend replication = case(\r\n        sku contains \"LRS\", \"Locally Redundant\",\r\n        sku contains \"GRS\", \"Geo Redundant\", \r\n        sku contains \"ZRS\", \"Zone Redundant\",\r\n        \"Other\"\r\n    )\r\n| where \"{ResourceGroups}\" == \"value::all\" or resourceGroup in ({ResourceGroups})\r\n| summarize StorageCount = count() by sku, replication\r\n| order by StorageCount desc",
              "size": 0,
              "title": "Storage Account Configuration Summary",
              "timeContext": {
                "durationMs": 86400000
              },
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "visualization": "piechart"
            },
            "name": "query - storage config"
          },
          {
            "type": 1,
            "content": {
              "json": "**Storage Account Distribution Analysis**\n\nThis chart shows the distribution of storage accounts by SKU type and replication settings. It helps identify optimization opportunities and ensure appropriate redundancy levels are configured across your environment."
            },
            "name": "text - storage config explanation"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "Resources\r\n| where type == \"microsoft.network/virtualnetworks\"\r\n| extend addressSpace = properties.addressSpace.addressPrefixes\r\n| mvexpand addressSpace\r\n| extend \r\n    vnetName = name,\r\n    cidr = tostring(addressSpace),\r\n    subnets = array_length(properties.subnets)\r\n| where \"{ResourceGroups:escape}\" == \"value::all\" or resourceGroup in ({ResourceGroups})\r\n| project VNetName = vnetName, ResourceGroup = resourceGroup, CIDR = cidr, SubnetCount = subnets, Location = location\r\n| order by ResourceGroup, VNetName",
              "size": 0,
              "title": "Virtual Network Topology Overview",
              "timeContext": {
                "durationMs": 86400000
              },
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "VNetName",
                    "formatter": 1,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "linkIsContextBlade": true
                    }
                  }
                ],
                "filter": true
              }
            },
            "name": "query - network topology"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "HealthResources\r\n| where type == \"microsoft.resourcehealth/availabilitystatuses\"\r\n| extend \r\n    resourceId = tostring(properties.targetResourceId),\r\n    availabilityState = tostring(properties.availabilityState),\r\n    reasonType = tostring(properties.reasonType)\r\n| summarize count() by availabilityState, reasonType\r\n| order by availabilityState",
              "size": 0,
              "title": "Resource Health Status Overview",
              "timeContext": {
                "durationMs": 86400000
              },
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "visualization": "piechart",
              "chartSettings": {
                "seriesLabelSettings": [
                  {
                    "seriesName": "Available",
                    "color": "green"
                  },
                  {
                    "seriesName": "Unavailable",
                    "color": "red"
                  },
                  {
                    "seriesName": "Degraded",
                    "color": "orange"
                  }
                ]
              }
            },
            "name": "query - resource health"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "CloudEngineer"
      },
      "name": "group - cloud engineer"
    },
    {
      "type": 1,
      "content": {
        "json": "---\n\n## ðŸ”— Quick Links & Actions\n\n**Azure Portal Quick Access:**\n- [Azure Policy Compliance](https://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Compliance)\n- [Microsoft Defender for Cloud](https://portal.azure.com/#view/Microsoft_Azure_Security/SecurityMenuBlade/~/0)\n- [Resource Graph Explorer](https://portal.azure.com/#view/HubsExtension/ArgQueryBlade)\n- [Cost Management](https://portal.azure.com/#view/Microsoft_Azure_CostManagement/Menu/~/overview)\n\n**Dashboard Actions:**\n- ðŸ“Š **Export Data:** Use the export options in each chart for further analysis\n- ðŸ”„ **Refresh Data:** Dashboard auto-refreshes every 5 minutes, or click refresh manually\n- âš™ï¸ **Customize:** Modify parameters above to filter data for specific scopes\n- ðŸ“‹ **Share:** Use the share button to distribute dashboard links to stakeholders\n\n*This dashboard provides real-time insights into your Azure environment's compliance posture. For detailed remediation guidance, refer to the specific policy recommendations and Microsoft Defender for Cloud findings.*"
      },
      "name": "text - footer"
    }
  ],
  "defaultResourceIds": [
    "/subscriptions"
  ],
  "fallbackResourceIds": [
    "value::all"
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}
